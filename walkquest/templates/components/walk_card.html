{% load slippers %}
{% load i18n %}

<div class="walk-item cursor-pointer"
     :class="{
        'walk-item-selected': selectedWalk?.id === walk.id,
        'walk-item-pending': pendingFavorites.has(walk.id)
     }" 
     :key="walk.id"
     x-data="{ showDetails: false }"
     @click="$dispatch('walk-selected', walk)">
    
    <div class="flex justify-between items-start">
        <h3 class="text-lg font-semibold text-gray-900 truncate" x-text="walk.walk_name"></h3>
        
        <!-- Favorite Button -->
        <button @click.stop="toggleFavorite(walk.id)"
                class="favorite-button"
                :class="{
                    'favorite-button-active': walk.is_favorite,
                    'favorite-button-inactive': !walk.is_favorite,
                    'favorite-button-pending': pendingFavorites.has(walk.id)
                }">
            <span class="sr-only" x-text="walk.is_favorite ? '{% translate "Remove from favorites" %}' : '{% translate "Add to favorites" %}'"></span>
            <!-- Loading spinner for pending state -->
            <div x-show="pendingFavorites.has(walk.id)" class="loading-spinner"></div>
            <iconify-icon icon="mdi:star" class="w-5 h-5" :class="{ 'fill-current': walk.is_favorite }"></iconify-icon>
        </button>
    </div>

    <div class="mt-2 flex items-center space-x-2 text-sm text-gray-600">
        <span x-text="`${walk.distance.toFixed(1)} km`"></span>
        <template x-if="walk.steepness_level">
            <span class="px-2 py-1 rounded-full text-xs"
                  :class="{
                      'bg-green-100 text-green-800': walk.steepness_level === 'EASY',
                      'bg-yellow-100 text-yellow-800': walk.steepness_level === 'MODERATE',
                      'bg-red-100 text-red-800': walk.steepness_level === 'HARD'
                  }"
                  x-text="walk.steepness_level">
            </span>
        </template>
    </div>

    <!-- Primary Categories -->
    <div class="mt-2 flex flex-wrap gap-2">
        <template x-for="category in walk.categories.slice(0, 3)" :key="category.slug">
            <span class="category-tag">
                <span x-text="category.name"></span>
            </span>
        </template>
    </div>

    <!-- Expandable Content -->
    <div class="expandable-content overflow-hidden">
        <!-- Additional Categories -->
        <div class="mt-2 flex flex-wrap gap-2">
            <template x-for="category in walk.categories.slice(3)" :key="category.slug">
                <span class="category-tag">
                    <span x-text="category.name"></span>
                </span>
            </template>
        </div>

        <!-- Full Description -->
        <div class="highlights mt-4 text-sm text-gray-600">
            <p x-text="walk.description || walk.highlights"></p>
        </div>

        <!-- Additional Details -->
        <div class="mt-4 grid grid-cols-2 gap-4 text-sm text-gray-600">
            <div>
                <span class="font-medium">{% translate "Duration" %}:</span>
                <span x-text="walk.duration"></span>
            </div>
            <div>
                <span class="font-medium">{% translate "Elevation" %}:</span>
                <span x-text="`${walk.elevation_gain}m`"></span>
            </div>
        </div>
    </div>

    <!-- Features -->
    <div class="mt-3 flex flex-wrap gap-2">
        <template x-if="walk.has_pub">
            <span class="inline-flex items-center text-xs text-gray-500">
                <iconify-icon icon="mdi:beer" class="w-4 h-4 mr-1"></iconify-icon>
                {% translate "Pub Stop" %}
            </span>
        </template>
        <template x-if="walk.has_cafe">
            <span class="inline-flex items-center text-xs text-gray-500">
                <iconify-icon icon="mdi:coffee" class="w-4 h-4 mr-1"></iconify-icon>
                {% translate "CafÃ© Stop" %}
            </span>
        </template>
        <template x-if="walk.has_parking">
            <span class="inline-flex items-center text-xs text-gray-500">
                <iconify-icon icon="mdi:parking" class="w-4 h-4 mr-1"></iconify-icon>
                {% translate "Parking Available" %}
            </span>
        </template>
    </div>
</div>
