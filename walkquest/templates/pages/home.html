{% extends "base.html" %}
{% load static %}
{% load i18n %}

{% block title %}{% translate "Walks" %} - {{ block.super }}{% endblock %}

{% block content %}
    <!-- Embed JSON data safely -->
    {{ config|json_script:"config-data" }}
    {{ initial_walks|json_script:"walks-data" }}
    {{ tags_data|json_script:"tags-data" }}

    <!-- Error container -->
    <div id="error-container" class="hidden bg-red-100 border-l-4 border-red-500 text-red-700 p-4" role="alert"></div>

    <!-- Main content with Alpine.js -->
    <div class="layout-container" 
         x-data="walkInterface"
         x-cloak>
        <!-- Sidebar -->
        <aside class="sidebar"
               x-show="showSidebar"
               x-transition:enter="transition ease-out duration-300"
               x-transition:enter-start="opacity-0 transform -translate-x-full"
               x-transition:enter-end="opacity-100 transform translate-x-0"
               x-transition:leave="transition ease-in duration-300"
               x-transition:leave-start="opacity-100 transform translate-x-0"
               x-transition:leave-end="opacity-0 transform -translate-x-full">
            
            <!-- Search input -->
            <div class="search-container">
                <input type="text"
                       x-model="searchQuery"
                       placeholder="{% translate 'Search walks...' %}"
                       class="search-input">
            </div>

            <!-- Walks list -->
            <div class="walks-list" x-show="!isLoading">
                <template x-for="walk in filteredWalks" :key="walk.id">
                    <div class="walk-card"
                         :class="{ 'selected': selectedWalk?.id === walk.id }"
                         @click="selectWalk(walk.id)">
                        <h3 x-text="walk.walk_name"></h3>
                        <p x-text="formatDistance(walk.distance)"></p>
                    </div>
                </template>
            </div>

            <!-- Loading state -->
            <div x-show="isLoading" class="loading-spinner">
                <span class="sr-only">Loading...</span>
            </div>
        </aside>

        <!-- Map container -->
        <main class="map-container">
            <div x-ref="map" class="map"></div>
        </main>
    </div>
{% endblock %}

{% block extra_javascript %}
    <script src='https://api.mapbox.com/mapbox-gl-js/v3.9.4/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.9.4/mapbox-gl.css' rel='stylesheet' />
{% endblock %}
