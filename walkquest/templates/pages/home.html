{% extends "base.html" %}
{% load static %}

{% block title %}Walks - {{ block.super }}{% endblock %}

{% block extra_head %}
<style>
    .mapboxgl-popup-content { @apply p-4 rounded-lg shadow-lg; }
    .walk-card { @apply p-4 border-b hover:bg-gray-50 transition-colors cursor-pointer; }
    .walk-card--selected { @apply bg-blue-50; }
</style>

<!-- Core Dependencies -->
<script type="module">
    // Import mapboxgl
    import mapboxgl from 'https://cdn.skypack.dev/mapbox-gl';
    
    // Then import virtualizer with correct exports
    import { 
        Virtualizer,
        observeElementOffset,
        observeElementRect,
        elementScroll
    } from 'https://esm.run/@tanstack/virtual-core';

    // Make available globally
    window.mapboxgl = mapboxgl;

    // App Configuration
    window.APP_CONFIG = {
        mapboxToken: "{{ mapbox_token|escapejs }}",
        // featureIcons: {{ feature_icons_json|safe }}
        map: {
            style: "mapbox://styles/mapbox/outdoors-v12",
            defaultCenter: [-4.85, 50.40],
            defaultZoom: 9,
            markerColors: {
                default: "#4F46E5",
                selected: "#DC2626"
            }
        },
        ui: {
            list: {
                itemSize: 92,
                overscan: 5,
                debounceMs: 300
            }
        }
    };

    // Create virtualizer with proper options
    window.createVirtualizer = (container, items) => {
        if (!container) return null;

        return new Virtualizer({
            count: items.length,
            getScrollElement: () => container,
            estimateSize: () => window.APP_CONFIG.ui.list.itemSize,
            overscan: window.APP_CONFIG.ui.list.overscan,
            scrollToFn: elementScroll,
            observeElementRect,
            observeElementOffset,
            onChange: (instance) => {
                instance.measureElement(container);
            }
        });
    };
</script>
{% endblock %}