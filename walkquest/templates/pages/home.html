{% extends "base.html" %}
{% load static %}

{% block content %}
<div id="app" class="h-screen w-screen">
    <div id="map" class="w-full h-full"></div>
    <div id="sidebar" class="absolute top-4 right-4 bg-white p-4 rounded-lg shadow-lg max-w-md">
        <h2 class="text-xl font-bold mb-4">Available Walks</h2>
        <div id="walks-list">
            {% for walk in walks %}
            <div class="walk-item mb-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"
                 data-lat="{{ walk.latitude }}"
                 data-lng="{{ walk.longitude }}"
                 data-title="{{ walk.title }}"
                 data-description="{{ walk.description }}">
                <h3 class="font-bold">{{ walk.title }}</h3>
                <p class="text-sm text-gray-600">{{ walk.description }}</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<script>
window.addEventListener('solid-loaded', () => {
    const { createSignal, onMount } = window.solidJs;
    
    const [map, setMap] = createSignal(null);
    const walkElements = document.querySelectorAll('.walk-item');
    
    onMount(() => {
        const mapInstance = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v11',
            center: [0, 0],
            zoom: 2,
            accessToken: "{{ mapbox_token }}"
        });

        mapInstance.addControl(new mapboxgl.NavigationControl());
        setMap(mapInstance);

        const bounds = new mapboxgl.LngLatBounds();

        walkElements.forEach(el => {
            const lat = parseFloat(el.dataset.lat);
            const lng = parseFloat(el.dataset.lng);
            const title = el.dataset.title;
            const description = el.dataset.description;

            // Add marker
            new mapboxgl.Marker()
                .setLngLat([lng, lat])
                .setPopup(
                    new mapboxgl.Popup({ offset: 25 })
                        .setHTML(`<h3>${title}</h3><p>${description}</p>`)
                )
                .addTo(mapInstance);

            bounds.extend([lng, lat]);

            // Add click handler
            el.addEventListener('click', () => {
                mapInstance.flyTo({
                    center: [lng, lat],
                    zoom: 14
                });
            });
        });

        if (walkElements.length > 0) {
            mapInstance.fitBounds(bounds, { padding: 50 });
        }
    });
});
</script>
{% endblock %}