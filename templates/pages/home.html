{% extends "base.html" %}
{% load static %}

{% block content %}
<div id="app" class="h-screen w-screen overflow-hidden">
    <div id="loading" class="h-full flex items-center justify-center">
        <div class="text-gray-600">Loading application...</div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script type="module">
    import { render } from 'solid-js/web';
    import App from '{% static "js/components/App.jsx" %}';

    window.addEventListener('solid-loaded', () => {
        try {
            const appData = {
                walks: {{ walks_json|safe }},
                mapboxToken: "{{ mapbox_token }}",
                user: {{ user_json|safe }},
            };

            const loadingElement = document.getElementById('loading');
            const root = document.getElementById('app');
            
            if (!root) {
                throw new Error('App container not found');
            }

            // First render the app
            render(() => <App {...appData} />, root);

            // Then remove loading element if it exists
            if (loadingElement) {
                loadingElement.remove();
            }
        } catch (e) {
            console.error('Application initialization failed:', e);
            const appElement = document.getElementById('app');
            if (appElement) {
                appElement.innerHTML = `
                    <div class="p-4 bg-red-100 text-red-700">
                        An unexpected error occurred while initializing the application
                    </div>
                `;
            }
        }
    }, { once: true });
</script>
{% endblock %}